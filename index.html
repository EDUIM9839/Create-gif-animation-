<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Static Image Animation with Dynamic Options</title>
  <style>
    #canvas1 {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 600px;
      height: 600px;
    }
    .controls {
      position: absolute;
      z-index: 10;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }
    .controls input, .controls select {
      font-size: 18px;
      margin: 10px;
    }
  </style>
</head>
<body>
<canvas id="canvas1"></canvas>
<div class="controls">
  <input type="file" id="imageUpload" accept="image/*" />
  <br>
  <label for="animations">Choose Animation:</label>
  <select id="animations"></select>
</div>

<script>
const canvas = document.getElementById("canvas1");
const ctx = canvas.getContext("2d");
canvas.width = 600;
canvas.height = 600;

let img = new Image();
let imgLoaded = false;
let playerState = 'idle';
let frameCount = 0;

// 1. Dynamically add options to the <select>
const animationList = [
  "idle", "jump", "fall", "run", "dizzy",
  "sit", "roll", "bite", "ko", "gethit"
];

const select = document.getElementById("animations");
animationList.forEach(anim => {
  const option = document.createElement("option");
  option.value = anim;
  option.textContent = anim.charAt(0).toUpperCase() + anim.slice(1);
  select.appendChild(option);
});

// 2. Handle animation selection
select.addEventListener("change", (e) => {
  playerState = e.target.value;
});

// 3. Handle image upload
document.getElementById("imageUpload").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(evt) {
    img.onload = function() {
      imgLoaded = true;
    };
    img.src = evt.target.result;
  };
  reader.readAsDataURL(file);
});

// 4. Simulated animation
function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (imgLoaded) {
    let dx = 0, dy = 0, angle = 0;

    switch (playerState) {
      case 'idle':
        break;
      case 'jump':
        dy = Math.sin(frameCount * 0.1) * -20;
        break;
      case 'fall':
        dy = Math.sin(frameCount * 0.1) * 10;
        break;
      case 'run':
        dx = Math.sin(frameCount * 0.2) * 25;
        break;
      case 'dizzy':
        angle = Math.sin(frameCount * 0.2) * 1;
        break;
      case 'sit':
        ctx.globalAlpha = 0.5;
        break;
      case 'roll':
        angle = frameCount * 0.1;
        break;
      case 'bite':
        dx = Math.sin(frameCount * 0.4) * 10;
        break;
      case 'ko':
        ctx.globalAlpha = 1 - (frameCount % 100) / 100;
        dy = 20;
        break;
      case 'gethit':
        ctx.globalAlpha = (frameCount % 10 < 5) ? 0.2 : 1;
        break;
    }

    ctx.save();
    ctx.translate(canvas.width / 2 + dx, canvas.height / 2 + dy);
    if (angle) ctx.rotate(angle);
    ctx.drawImage(img, -img.width / 2, -img.height / 2);
    ctx.restore();
    ctx.globalAlpha = 1;
  }

  frameCount++;
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
